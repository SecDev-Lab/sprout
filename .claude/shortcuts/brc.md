# +brc - Branch Review & Cleanup

現在のブランチと main ブランチの差分を確認し、ブランチのクリーンアップを行います。

## 概要

このコマンドは、PR作成前の品質チェックとクリーンアップを包括的に実行します。特に以下に注力します：

- コード品質の確保（lint、format）
- 不要なファイルやコードの削除
- **tmp/ ディレクトリの完全なクリーンアップ**
- TODOの精査と解決
- テストの成功確認

## 実行手順

### 1. 差分確認
```bash
git diff main...HEAD
git diff --name-only main...HEAD
```
現在のブランチで変更されたファイルとその内容を確認します。

### 2. 不要ファイル・コード断片の削除
- デバッグ用の print 文、console.log、一時的なコメントアウトを削除
- テスト用の一時ファイル（test_*.py, *.log, *.tmp など）で、実際のテストに使われていないものを削除
- 不要な import 文を削除
- 実装中にのみ使用した実験的なコードを削除
- **tmp/ ディレクトリのクリーンアップ**：
  ```bash
  # tmp/ ディレクトリの内容を確認
  if [ -d "tmp/" ]; then
    echo "=== tmp/ ディレクトリの内容 ==="
    ls -la tmp/
    echo "これらのファイルを削除しますか？ (y/N)"
    # ユーザーの確認を待つ
    read -r response
    if [[ "$response" =~ ^[Yy]$ ]]; then
      rm -rf tmp/*
      echo "tmp/ ディレクトリをクリーンアップしました"
    fi
  else
    echo "tmp/ ディレクトリは存在しません"
  fi
  ```

### 3. TODO精査と解決
```bash
# TODO コメントを検索
rg "TODO|FIXME|XXX|HACK" --type-add 'code:*.{py,ts,js,tsx,jsx}' -t code
```
- 見つかった TODO を一つずつ確認
- 現在のブランチで解決すべきものは即座に解決
- 将来のタスクとして残すべきものは、理由を明確にしてサマリーに記載

### 4. フォーマット修正
```bash
make format
make lint
```
- lint エラーがある場合は、エラーメッセージを確認して修正
- 自動修正できないエラーは手動で修正

### 5. テスト修正
```bash
make test
```
- テストが失敗した場合：
  - まずエラーメッセージを分析
  - テストの期待値が正しいか確認
  - 実装を修正すべきか、テストを修正すべきか判断
  - テストより実装を優先すべき場合は、その理由をサマリーに記載

### 6. 最終確認とサマリー表示
以下の形式でサマリーを表示：

```
## ブランチレビューサマリー

### 変更内容
- 変更ファイル数: X files
- 追加行数: +XXX
- 削除行数: -XXX

### クリーンアップ実施内容
- [ ] 不要なデバッグコード削除
- [ ] 未使用 import 削除
- [ ] 一時ファイル削除
- [ ] tmp/ ディレクトリクリーンアップ

### TODO状況
- 解決済み: X件
- 残存: X件
  - [理由] TODO内容

### テスト・品質チェック
- [ ] make format: PASS/FAIL
- [ ] make lint: PASS/FAIL  
- [ ] make test: PASS/FAIL

### 残課題
（もしあれば記載）

### 次のステップ
（全てのチェックが PASS の場合）
PR作成の準備が整いました。以下のコマンドで PR を作成してください：
gh pr create --title "タイトル" --body "説明"
```

## 注意事項
- 実装の意図を損なわないよう、慎重に不要コードを判断すること
- テストが失敗した場合、安易にテストを修正せず、実装の正しさを優先的に検証すること
- PR 作成は自動では行わず、ユーザーの最終確認を促すこと
- **tmp/ ディレクトリについて**：
  - Claude Codeが作成した全ての中間ファイル（テストファイル、計画ドキュメント等）は tmp/ に配置される
  - +brc 実行時に必ずクリーンアップを実施する
  - 削除前にユーザーの確認を求める