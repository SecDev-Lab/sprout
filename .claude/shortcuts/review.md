# GitHub Pull Request Review (+review)

GitHubのプライベートリポジトリのPull Requestを詳細にレビューするショートカットです。

## 概要

このコマンドは、指定されたPRの包括的なコードレビューを実行し、品質評価とアクションアイテムを提供します。レビュー処理中に作成される中間ファイルは `tmp/` ディレクトリに配置され、処理完了後に自動的にクリーンアップされます。

## 使用方法

```
+review <PR_URL>
```

例：
```
+review https://github.com/owner/repo/pull/123
```

## 機能

このショートカットは以下のタスクを実行します：

1. **PRの基本情報取得**
   - `gh pr view`でPR詳細情報を取得
   - タイトル、説明、レビュアー、ステータス等

2. **コード変更の詳細分析**
   - `gh pr diff`で変更内容を取得
   - 各ファイルの変更行数と内容を分析

3. **品質レビュー**
   - コーディングスタイル、設計パターンの確認
   - セキュリティ、パフォーマンスの観点からの分析
   - 潜在的な問題点の指摘

4. **総合評価とアクションアイテム**
   - マージ可否の判断
   - 具体的な改善提案

5. **中間ファイルのクリーンアップ**
   - レビュー処理中に `tmp/` ディレクトリに作成された中間ファイルを自動削除
   - 作業環境のクリーンアップ

## 前提条件

- GitHub CLIがインストール済み（`gh`コマンド利用可能）
- `gh auth login`で認証済み
- レビュー対象リポジトリへの読み取り権限

## 実行プロセス

ショートカット実行時、Claude Codeは以下を順次実行します：

1. PR URLからowner/repo/pr-numberを抽出
2. `gh pr view` でPR基本情報取得
3. `gh pr diff` で変更差分取得  
4. 取得したデータを基に詳細レビュー実施
5. 構造化されたレビュー結果を出力
6. **tmp/ ディレクトリのクリーンアップ**
   ```bash
   # レビュー中に作成された中間ファイルを確認・削除
   if [ -d "tmp/" ] && [ "$(ls -A tmp/)" ]; then
     echo "=== レビュー処理で作成された中間ファイル ==="
     ls -la tmp/
     rm -rf tmp/*
     echo "tmp/ ディレクトリをクリーンアップしました"
   fi
   ```

## 出力形式

```markdown
# PR Review: [PR Title]

## 基本情報
- Repository: owner/repo
- PR番号: #XXX
- 作成者: [author]
- ステータス: [open/closed/merged]
- 変更ファイル数: XX files
- 変更行数: +XXX -XXX

## 変更概要
[PRの目的と主要な変更内容]

## ファイル別変更詳細
### [filename]
- 変更タイプ: [新規/修正/削除]
- 主な変更点:
  - [具体的な変更内容]

## コード品質評価
### ✅ 良い点
- [具体的な評価ポイント]

### ⚠️ 改善検討点  
- [具体的な改善提案]

### 🚨 潜在的問題
- [セキュリティ/パフォーマンス/バグリスク]

## 総合評価
**マージ判定**: [✅ APPROVE / ⚠️ REQUEST_CHANGES / 💬 COMMENT]

**理由**: [判定理由の詳細]

## 推奨アクション
- [ ] [具体的な修正提案]
- [ ] [テスト追加提案]  
- [ ] [ドキュメント更新提案]
```

## 注意事項

- レビュー結果はClaude Code上にのみ表示されます
- GitHub上への自動コメント投稿は行いません
- 大きなPRの場合、分析に時間がかかる場合があります
- プライベートリポジトリには適切な権限が必要です
- **tmp/ ディレクトリについて**：
  - レビュー処理中の中間ファイル（分析データ、一時レポート等）は tmp/ に配置される
  - レビュー完了後、中間ファイルは自動的に削除される
  - 削除前に内容を確認し、ログ出力で削除内容を報告する