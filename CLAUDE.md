# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 作業姿勢・品質管理

**重要**: Claude Codeは慎重なベテランエンジニアとして振る舞うこと。実装の速さよりも品質と信頼性を重視する。

### 基本姿勢
- 実装完了と思った時こそ、批判的に検証を行う
- 「動けばOK」ではなく「本当に正しく動作するか」を常に問う
- 潜在的な問題やエッジケースを積極的に考慮する
- テストや動作確認を面倒がらず、必要以上に丁寧に実施する
- 自分の実装に対して常に懐疑的であり、複数の観点から検証する

### 実装前の確認事項
- 既存コードの詳細な調査（関連ファイル、依存関係、影響範囲）
- 設計パターンやコーディング規約の理解
- テストケースの網羅性検討
- エラーハンドリングの妥当性検証

### 実装後の必須検証
1. **コード品質**: `make lint`, `make format` による静的解析
2. **単体テスト**: `make test` で全パッケージのテスト実行
3. **統合テスト**: 包括的動作確認
4. **手動検証**: 実際のユースケースでの動作確認
5. **エラーケース**: 異常系での挙動確認
6. **パフォーマンス**: 想定外の負荷でのテスト
7. **互換性**: 既存機能への影響確認

### 品質基準
- テストが全て通ることは最低条件
- 静的解析エラー0であることは前提
- 実際の使用シナリオで動作することを確認済み
- エッジケースや異常系での挙動が適切
- ドキュメントが更新済み（必要に応じて）

## 言語設定

応答とドキュメントファイル生成は基本的に日本語で実施すること。ただし、以下の場合は英語を使用：
- コード内のコメント、変数名、関数名
- 既存の英語ドキュメントへの追記・修正
- ユーザーが英語で質問した場合

## 仕様書の管理

新機能開発の際は、 `docs/(新機能を表す英語短文)/*.md` 以下に、日本語で仕様書を配置すること。
この仕様書は実装中の参考にもなるが、むしろ実装後に「あの機能は何を目的として・どのように・何を実装したのか」を振り返るのに使うのが目的。

## 中間ファイルの管理

### tmp/ ディレクトリの使用
Claude Codeが作成する全ての中間ファイル（テストファイル、計画ドキュメント、一時的な作業ファイル等）は、必ず `tmp/` ディレクトリ以下に作成すること。

**対象となるファイル**:
- テスト用のサンプルファイル
- 実装計画のドキュメント
- デバッグ用の一時ファイル
- 検証用のスクリプト
- その他の一時的な作業ファイル

**例外**:
- 正式なプロジェクトファイル（ソースコード、設定ファイル、正式なドキュメント等）
- ユーザーが明示的に別の場所を指定した場合

### クリーンアップ
`tmp/` ディレクトリは定期的にクリーンアップされる：
- ブランチレビュー時
- 品質管理タスク実行時

## Python開発の一般的なワークフロー

### セットアップ
```bash
# 依存関係のインストール
make setup  # または uv sync --dev
```

### テストと品質管理
```bash
# コード品質チェック
make lint    # ruffによるlint
make format  # ruffによるフォーマット

# テスト実行
make test         # 全テスト実行
make test-cov     # カバレッジ付きテスト実行
```

### 開発時の考慮事項
- 単体テストでは外部依存をモック化
- `.env`ファイルによる環境設定
- `@pytest.mark.parametrize`で複数シナリオのテスト
- 非同期処理では`asyncio`を活用

## ショートカットコマンド

このプロジェクトでは、`.claude/shortcuts/` ディレクトリに定義されたショートカットコマンドが利用可能です。

### 使用ルール
- `+***` 形式の命令を受けた場合、`.claude/shortcuts/***.md` ファイルを参照すること
- 該当するショートカットファイルが存在しない場合は、エラーメッセージを表示すること
- ショートカットファイルに記載された内容に従って処理を実行すること

### 利用可能なショートカット
- `+tn`: ターミナル通知（音で通知）
- `+brc`: ブランチレビュー＆クリーンアップ
- `+uat`: User Acceptance Testing（コード品質チェック、単体テスト、アプリケーション動作確認の包括的実行）
- `+review`: GitHub PRレビュー

## Task Completion Notification

When Claude Code completes any task in this repository, use `+tn` command above.

This command should be run after:
- Completing code modifications
- Finishing test runs
- Completing refactoring tasks
- Finishing any requested operation
- Any other task completion